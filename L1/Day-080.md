# Day 80: Jenkins Chained Builds

## Scenario

The DevOps team was looking for a solution where they want to restart Apache service on all app servers if the deployment goes fine on these servers in Stratos Datacenter. After having a discussion, they came up with a solution to use Jenkins chained builds so that they can use a downstream job for services which should only be triggered by the deployment job. So as per the requirements mentioned below configure the required Jenkins jobs.

- Click on the `Jenkins` button on the top bar to access the Jenkins UI. Login using username `admin` and password `Adm!n321`.
- Similarly, click on the `Gitea` button on the top bar to access the `Gitea UI`. Login using username `sarah` and password `Sarah_pass123`. There under user sarah you will find a repository named `web`. 
- Apache is already installed and configured on all app server so no changes are needed there. The doc root `/var/www/html` on all these app servers is shared among the Storage server under `/var/www/html` directory.
- Create a Jenkins job named `nautilus-app-deployment` and configure it to pull change from the `master` branch of `web` repository on `Storage server` under `/var/www/html` directory, which is already a local git repository tracking the origin web repository. Since `/var/www/html` on `Storage server` is a shared volume so changes should auto reflect on all apps.
- Create another Jenkins job named `manage-services` and make it a `downstream job` for `nautilus-app-deployment` job. Things to take care about this job are:
  - This job should restart `httpd` service on all app servers.
  - Trigger this job only if the `upstream job` i.e `nautilus-app-deployment` is stable.

> **Note:**

- You might need to install some plugins and restart Jenkins service. So, we recommend clicking on `Restart Jenkins when installation is complete and no jobs are running` on plugin installation/update page i.e `update centre`. Also, Jenkins UI sometimes gets stuck when Jenkins service restarts in the back end. In this case, please make sure to refresh the UI page.
- Make sure Jenkins job passes even on repetitive runs as validation may try to build the job multiple times.
- Deployment related tasks should be done by `sudo` user on the destination server to avoid any permission issues so make sure to configure your Jenkins job accordingly. 
- For these kind of scenarios requiring changes to be done in a web UI, please take screenshots so that you can share it with us for review in case your task is marked incomplete. You may also consider using a screen recording software such as loom.com to record and share your work.
---

## Task

- Access the `Jenkins` via UI.
- Install Plugins.
- Setup `Credential & system`.
- Create `pipeline`.
- Create `job`.


---

## Solution

### 1. Access Jenkin via UI

```bash
Click on Jenkins button.
```
---

### 2. Install Plugins
```bash
Goto >> Manage Jenkins >> Plugins >> Select ssh, Git, Pipeline >> Click on Install.
```

---



### 3.Install java on storage server.

```bash
 dnf install fontconfig java-21-openjdk 
```


---



### 4. Setup Credentials

<img width="2716" height="922" alt="image" src="https://github.com/user-attachments/assets/6a344048-7b32-46d6-a96e-c2aca4f0b763" />

---


### 5. Create Node

<img width="2698" height="1350" alt="image" src="https://github.com/user-attachments/assets/6b222410-5892-4d77-b5e4-523d508de212" />


---

#### 6. Create Systems

<img width="2698" height="1382" alt="image" src="https://github.com/user-attachments/assets/cdff97a5-fbbe-4846-985f-3c4fc7e919d4" />

> Similarly add for App02 & App03

---

### 7. Create job nautilus-app-deployment

```groovy
pipeline {
    agent { label 'ststor01' }

    stages {
        stage('Checkout') {
            steps {
                // Connect to Git and download the repository
                git branch: 'master', url: 'http://git.stratos.xfusioncorp.com/sarah/web.git'
            }
        }

        stage('Update Code') {
            steps {
                // Pull latest changes from the Git repository
                sh 'cd /var/www/html && git pull origin master'
            }
        }
    }
}


```

nautilus-app-deployment

<img width="2698" height="1382" alt="image" src="https://github.com/user-attachments/assets/9c2a1ed2-0ecc-4357-acd2-1683df111e20" />

---

### 7. Create job manage-services

<img width="2698" height="1382" alt="image" src="https://github.com/user-attachments/assets/5ae56021-5cbe-40c5-b90d-66dccef003b1" />

> Similary in build steps add for App02 & App03

> In next run check page by clicking on app.

---

> **Result:**  Validate result.
By clicking on App
