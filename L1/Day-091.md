# Day 91: Ansible Lineinfile Module

## Scenario

The Nautilus DevOps team want to install and set up a simple `httpd` web server on all app servers in `Stratos DC`. They also want to deploy a sample web page using Ansible. Therefore, write the required playbook to complete this task as per details mentioned below.

- We already have an `inventory` file under `/home/thor/ansible` directory on `jump host`. Write a playbook playbook.yml under `/home/thor/ansible` directory on `jump host` itself. Using the playbook perform below given tasks:
- Install `httpd` web server on all app servers, and make sure its service is up and running.
- Create a file `/var/www/html/index.html` with content:
  `This is a Nautilus sample file, created using Ansible!`
- Using `lineinfile` Ansible module add some more content in `/var/www/html/index.html `file. Below is the content:
  `Welcome to Nautilus Group!`
  Also make sure this new line is added at the top of the file.

- The `/var/www/html/index.html` file's user and group owner should be `apache` on all `app servers`.
- The `/var/www/html/index.html` file's permissions should be `0777` on all `app servers`.


  > **Note:** Validation will run the playbook using the command `ansible-playbook -i inventory playbook.yml`. Ensure the playbook works without any additional arguments.
  
---

## Task

- Create `Inventory`.
- Create `playbook`.

---

## Solution

### 1. Create Inventory like below or use existing one:

```bash
[app_servers]
stapp01 ansible_host=172.16.238.10 ansible_user=tony ansible_password=Ir0nM@n ansible_python_interpreter=/usr/bin/python3 ansible_ssh_common_args='-o StrictHostKeyChecking=no'
stapp02 ansible_host=172.16.238.11 ansible_user=steve ansible_password=Am3ric@ ansible_python_interpreter=/usr/bin/python3 ansible_ssh_common_args='-o StrictHostKeyChecking=no'
stapp03 ansible_host=172.16.238.12 ansible_user=banner ansible_password=BigGr33n ansible_python_interpreter=/usr/bin/python3 ansible_ssh_common_args='-o StrictHostKeyChecking=no'
```
---

### 2. Create Playbook:

```yml
---
- name: Install and configure httpd with sample page
  hosts: all
  become: yes
  tasks:
    - name: Install httpd package
      package:
        name: httpd
        state: present

    - name: Ensure httpd service is enabled and running
      service:
        name: httpd
        state: started
        enabled: yes

    - name: Create index.html with initial content
      copy:
        dest: /var/www/html/index.html
        content: |
          This is a Nautilus sample file, created using Ansible!
        owner: apache
        group: apache
        mode: '0777'

    - name: Add extra line at the top of index.html
      lineinfile:
        path: /var/www/html/index.html
        line: "Welcome to Nautilus Group!"
        insertbefore: BOF
        owner: apache
        group: apache
        mode: '0777'


```

---



## Result

> Check ouput :
```bash
ansible all -i inventory -a "cat /var/www/html/index.html"
ansible all -i inventory -a "ls -l /var/www/html/index.html"
curl http://stapp01
curl http://stapp02
curl http://stapp03
```
