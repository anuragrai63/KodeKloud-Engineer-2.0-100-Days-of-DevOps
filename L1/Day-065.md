# Day 65: Deploy Redis Deployment on Kubernetes

## Scenario

The Nautilus application development team observed some performance issues with one of the application that is deployed in Kubernetes cluster. After looking into number of factors, the team has suggested to use some in-memory caching utility for DB service. After number of discussions, they have decided to use Redis. Initially they would like to deploy Redis on kubernetes cluster for testing and later they will move it to production. Please find below more details about the task:

- Create a `redis` deployment with following parameters:
    - Create a `config map` called `my-redis-config` having `maxmemory 2mb` in `redis-config`.
    - Name of the deployment should be `redis-deployment`, it should use `redis:alpine` image and container name should be `redis-container`. Also make sure it has only `1` replica.
    - The container should request for `1 CPU`.
    - Mount 2 volumes:
        - An Empty directory volume called data at path `/redis-master-data`.
        - A configmap volume called redis-config at path `/redis-master`.
        - The container should expose the port `6379`.
     - Finally, `redis-deployment` should be in an up and `running` state.



  > **Note:** The `kubectl` utility on jump_host is configured to operate with the Kubernetes cluster.

---

## Task

- Create `Redis` deployment with above mentioned config.
- Expose the service to make accessible on desired `port`.


---

## Solution

### 1. Create ConfigMap (my-redis-config.yaml)

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-redis-config
data:
  redis-config: |
    maxmemory 2mb

```
---


### 2. Create Redis Deployment (redis-deployment.yaml)
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: redis-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
      - name: redis-container
        image: redis:alpine
        ports:
        - containerPort: 6379
        resources:
          requests:
            cpu: "1"
        volumeMounts:
        - name: data
          mountPath: /redis-master-data
        - name: config
          mountPath: /redis-master
      volumes:
      - name: data
        emptyDir: {}
      - name: config
        configMap:
          name: my-redis-config

```
---

### 3. Apply Resources
```bash
kubectl apply -f my-redis-config.yaml
kubectl apply -f redis-deployment.yaml
```
---

### 3. Verify deployment
```bash
kubectl get pods
kubectl get cm 
kubectl get deployments.apps
kubectl describe pod redis-deployment-d6d674f5f-njj7p

```

> **Result:** Redis deployed and it's in running state.

