# Day 65: Deploy Redis Deployment on Kubernetes

## Scenario

The Nautilus application development team observed some performance issues with one of the application that is deployed in Kubernetes cluster. After looking into number of factors, the team has suggested to use some in-memory caching utility for DB service. After number of discussions, they have decided to use Redis. Initially they would like to deploy Redis on kubernetes cluster for testing and later they will move it to production. Please find below more details about the task:

- Create a `redis` deployment with following parameters:
    - Create a `config map` called `my-redis-config` having `maxmemory 2mb` in `redis-config`.
    - Name of the deployment should be `redis-deployment`, it should use `redis:alpine` image and container name should be `redis-container`. Also make sure it has only `1` replica.
    - The container should request for `1 CPU`.
    - Mount 2 volumes:
        - An Empty directory volume called data at path `/redis-master-data`.
        - A configmap volume called redis-config at path `/redis-master`.
        - The container should expose the port `6379`.
     - Finally, `redis-deployment` should be in an up and `running` state.



  > **Note:** The `kubectl` utility on jump_host is configured to operate with the Kubernetes cluster.

---

## Task

- Fix the issue to make `app` accessible.


---

## Solution

### 1. Check Deployment and pod

```bash
kubectl get deployment
kubectl get pods
```
---


### 2. Correct the typo in manifest
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "2"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"name":"python-deployment-datacenter","namespace":"default"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"python_app"}},"template":{"metadata":{"labels":{"app":"python_app"}},"spec":{"containers":[{"image":"poroko/flask-app-demo","name":"python-container-datacenter","ports":[{"containerPort":5000}]}]}}}}
  creationTimestamp: "2025-09-17T14:53:15Z"
  generation: 2
  name: python-deployment-datacenter
  namespace: default
  resourceVersion: "1102"
  uid: 39bdb669-0f8a-43da-8ec8-e167052f08e7
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: python_app
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: python_app
    spec:
      containers:
      - image: poroko/flask-demo-app   #updated 
        imagePullPolicy: Always
        name: python-container-datacenter
        ports:
        - containerPort: 5000
          protocol: TCP
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
status:
  availableReplicas: 1
  conditions:
  - lastTransitionTime: "2025-09-17T14:57:46Z"
    lastUpdateTime: "2025-09-17T14:57:46Z"
    message: Deployment has minimum availability.
    reason: MinimumReplicasAvailable
    status: "True"
    type: Available
  - lastTransitionTime: "2025-09-17T14:53:16Z"
    lastUpdateTime: "2025-09-17T14:57:46Z"
    message: ReplicaSet "python-deployment-datacenter-76b8f5c96c" has successfully
      progressed.
    reason: NewReplicaSetAvailable
    status: "True"
    type: Progressing
  observedGeneration: 2
  readyReplicas: 1
  replicas: 1
  updatedReplicas: 1
```
---

### 3. Check Pod status
```bash
kubectl get pods

```
---

### 3. Check service status & correct the ports
```bash
kubectl svc python-service-datacenter -o yaml 

```

```yaml
apiVersion: v1
kind: Service
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"name":"python-service-datacenter","namespace":"default"},"spec":{"ports":[{"nodePort":32345,"port":8080}],"selector":{"app":"python_app"},"type":"NodePort"}}
  creationTimestamp: "2025-09-17T14:53:16Z"
  name: python-service-datacenter
  namespace: default
  resourceVersion: "1309"
  uid: 67f06a69-61bd-443f-a33b-26251d89f78c
spec:
  clusterIP: 10.96.3.182
  clusterIPs:
  - 10.96.3.182
  externalTrafficPolicy: Cluster
  internalTrafficPolicy: Cluster
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - nodePort: 32345
    port: 5000   # Updated
    protocol: TCP
    targetPort: 5000 # Updated
  selector:
    app: python_app
  sessionAffinity: None
  type: NodePort
status:
  loadBalancer: {}
```
---


> **Result:** Image and ports corrected which resulted in app functioning properly.

