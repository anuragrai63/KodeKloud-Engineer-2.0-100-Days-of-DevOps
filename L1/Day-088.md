# Day 88: Ansible Blockinfile Module

## Scenario

The Nautilus DevOps team wants to install and set up a simple `httpd` web server on all app servers in `Stratos DC`. Additionally, they want to deploy a sample web page for now using Ansible only. Therefore, write the required playbook to complete this task. Find more details about the task below.

- We already have an inventory file under `/home/thor/ansible` directory on `jump host`. Create a `playbook.yml` under `/home/thor/ansible` directory on `jump host` itself.
  - Using the playbook, install `httpd` web server on all app servers. Additionally, make sure its service should up and running.
  - Using `blockinfile` Ansible module add some content in `/var/www/html/index.html` file. Below is the content:
  
  `Welcome to XfusionCorp!`

  `This is  Nautilus sample file, created using Ansible!`

  `Please do not modify this file manually!`
  - The `/var/www/html/index.html` file's user and group `owner` should be `apache` on all app servers.
  - The `/var/www/html/index.html` file's permissions should be `0744` on all app servers.

  
  > **Note:** Validation will run the playbook using the command `ansible-playbook -i inventory playbook.yml`. Ensure the playbook works without any additional arguments.
  > Do not use any custom or empty `marker` for `blockinfile` module.
---

## Task

- Create `Inventory`.
- Create `playbook`.

---

## Solution

### 1. Create Inventory:

```bash
[app_servers]
stapp01 ansible_host=172.16.238.10 ansible_user=tony ansible_password=Ir0nM@n ansible_python_interpreter=/usr/bin/python3 ansible_ssh_common_args='-o StrictHostKeyChecking=no'
stapp02 ansible_host=172.16.238.11 ansible_user=steve ansible_password=Am3ric@ ansible_python_interpreter=/usr/bin/python3 ansible_ssh_common_args='-o StrictHostKeyChecking=no'
stapp03 ansible_host=172.16.238.12 ansible_user=banner ansible_password=BigGr33n ansible_python_interpreter=/usr/bin/python3 ansible_ssh_common_args='-o StrictHostKeyChecking=no'
```
---

### 2. Create Playbook:

```yml
---
- name: Install and configure httpd with sample page
  hosts: app_servers
  become: yes
  tasks:
    - name: Install httpd package
      package:
        name: httpd
        state: present

    - name: Ensure httpd service is enabled and running
      service:
        name: httpd
        state: started
        enabled: yes
    - name: Ensure file present
      file:
        path: /var/www/html/index.html
        state: touch
        owner: apache
        group: apache
        mode: '0777'

    - name: Add sample content to index.html
      blockinfile:
        path: /var/www/html/index.html
        block: |
          Welcome to XfusionCorp!

          This is  Nautilus sample file, created using Ansible!

          Please do not modify this file manually!

    - name: Set ownership of index.html to apache
      file:
        path: /var/www/html/index.html
        owner: apache
        group: apache
        mode: '0744'

```

---



## Result

> Check ouput
